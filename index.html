<html>
<head>
    <title>Anderson Luis Mendonça</title>
    <meta charset="UTF-8"> <style>
        /* Adicionei um estilo básico para o campo de recebimento */
        #recebido {
            color: #007aff;
            font-weight: bold;
            font-family: monospace;
            background-color: #f4f4f4;
            padding: 2px 5px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Comunicação Delphi - Browser</h1>
    
    <button onclick="postarMensagemParaDelphi('Olá Sky Informática')">
        1. Enviar "Olá" para o Delphi
    </button>
    
    <hr> <h2>Dados Recebidos do Delphi:</h2>
    <p>
        O Delphi enviou: <span id="recebido">(Aguardando dados...)</span>
    </p>

    <script>
        /**
         * FUNÇÃO RECEPTORA (Chamada pelo Delphi)
         * Recebe dados DO Delphi e exibe na tela.
         */
        window.carregarDadosDoDelphi = function(jsonString) {
            try {
                console.log("Dados recebidos do Delphi:", jsonString);
                const elRecebido = document.getElementById('recebido');

                if (elRecebido) {
                    // Preenche o <span> com a string recebida
                    elRecebido.textContent = jsonString;
                }
            } catch (e) {
                console.error("Falha ao processar JSON do Delphi:", e, jsonString);
                alert("Erro ao receber dados do Delphi.");
            }
        };

        /**
         * FUNÇÃO EMISSORA (Chamada pelo HTML)
         * Envia dados PARA o Delphi.
         */
        function postarMensagemParaDelphi(mensagem) {
            if (window.chrome && window.chrome.webview) {
                window.chrome.webview.postMessage(mensagem);
                console.log('Mensagem enviada:', mensagem);
            } else {
                const erro = 'Erro: A aplicação não está rodando dentro do host WebView2 (Delphi).';
                console.error(erro);
            }
        }
    </script>
</body>
</html>
